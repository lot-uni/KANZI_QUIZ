<!DOCTYPE html>
<html lang="jp">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./static/css/main.css">
    <title>漢字ディフュージョン</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.0/jquery.min.js"></script> 
    <script>
        $(document).ready(function() {
            $("#fetchData").click(function() {
                const url = "https://l.combu.dev/normal/";
                var context = document.getElementById("context").value;
                var data = { context: context }; // 送信するデータをオブジェクトとして作成
                $.ajax({
                type: "POST", // POSTリクエスト
                url: url, // サーバーのエンドポイントを指定
                crossDomain: true,
                xhrFields: {
                  withCredentials: true // クレデンシャル情報を送信する
                },
                data: JSON.stringify(data), // データをJSON文字列に変換
                contentType: "application/json", // コンテンツタイプをJSONに指定
                dataType: "json", // レスポンスのデータタイプをJSONに指定
                    success: function(data) {
                        alert("pdfが完成しました！");
                        $("#DLC").attr("href", "/get_file/output.pdf");
                    },
                    error: function(xhr, status, error) {
                      $("#result").text("Error: " + error);
                    }
                });
            });
            $("#DLC").click(function() {
                console.log($("#DLC").attr("href"));
                if($("#DLC").attr("href")==undefined){
                    alert("まだテキストを送信できていません！");
                }else{
                    $("#DLC").removeAttr('href');
                    window.location.href = "/get_file/output.pdf";
                }
            });
        });
  
      </script>
</head>
<body>
    <header class="top-header">
        <div class="header-title">漢字ディフィュージョン</div>
    </header>
    <div class="view">
        <div class="table">
            <div class="tab input active">
                入力
            </div>
            <div class="tab output">
                出力
            </div>
        </div>
        <hr>
        <div class="tab-contents">
            <div id="question"></div>
            <div id="anser"></div>
            <div class="tab-contents-item show">
                <div class="input-frame">
                    <textarea class="textlines" id="context" context="" cols="30" rows="15"></textarea>
                    <button class="submit-outter" id="fetchData"><div class="submit-inner">作成ボタン</div></button>

                </div>
            </div>
            <div class="tab-contents-item">
                <a class="submit-outter" id="DLC"><div class="submit-inner">ダウンロード</div></a>
            </div>
          </div>
    </div>  
  <script src="./static/js/tab-action.js"></script>
</body>
</html>